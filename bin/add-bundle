#!/usr/bin/env perl
#
# add a git repo as a vim repository, with a minimum of fuss
#
# Chris Weyl <cweyl@alumni.drew.edu> 2012

use v5.10;
use strict;
use warnings;
use utf8;

use autodie 'system';

use IO::All;

# git://github.com/kien/ctrlp.vim.git

my ($remote) = @ARGV;
say "subrepository location: $remote";

$remote =~
    /^((https?|git):\/\/github\.com\/|git\@github\.com:)(?<user>[^\/]+)\/(?<repo>[^\/]+)\.git$/;

my $target = "bundle/$+{repo}";

say "Adding $+{user}'s repository $+{repo} at $target";
system "git submodule add $remote $target";
system "git config --file .gitmodules submodule.$target.update rebase";
system "git config                    submodule.$target.update rebase";
system "git commit -m 'add: $target' .gitmodules $target";

# ignore generated tags -- and yes, I'm being lazy right now
my $dir
    = -d "$target/.git"
    ? "$target"
    : ".git/modules/$target"
    ;

"doc/tags\n" >> io("$dir/info/exclude");

say "fin...";
