#!/bin/bash

. /usr/lib/git-core/git-sh-setup
#. git-sh-i18n
#set_reflog_action rebase
require_work_tree_exists
cd_to_toplevel

MODULE=$1

# get url
#REMOTE_URL=`git config submodule.\"$MODULE\"`
URL=`git config submodule.$MODULE.url`
COMMIT=`git submodule status $MODULE | sed -e 's/^ //; s/ .*$//'`

if [ -d "$MODULE/.git" ] ; then
    MODULE_GITDIR="$MODULE/.git"
else
    MODULE_GITDIR=".git/modules/$MODULE"
fi

set -ex
git config --file .gitmodules --remove-section submodule.$MODULE
git config                    --remove-section submodule.$MODULE ||:
rm -rf $MODULE_GITDIR
rm -rf $MODULE
git rm $MODULE
git add .gitmodules
git commit -m "rm: $MODULE"
